import"./CWj6FrbW.js";import{d as te,c as re,e as J,s as W}from"./gcnQ8rQN.js";import{aD as pe,G as ge,I as V,p as ae,d as R,B as de,e as E,h as f,i as _,r as u,a0 as Z,g as o,t as O,a as A,b as ie,s as S,f as oe}from"./D902iWF1.js";import{i as H}from"./ZYqiJWqh.js";import{f as me,s as Q,g as B,e as le,r as K,a as ee,h as he,b as se}from"./BESee3hx.js";import{s as be}from"./Bf8xj146.js";import{b as ce,p as ue}from"./BuPMYCAJ.js";const xe=()=>performance.now(),z={tick:a=>requestAnimationFrame(a),now:()=>xe(),tasks:new Set};function fe(){const a=z.now();z.tasks.forEach(t=>{t.c(a)||(z.tasks.delete(t),t.f())}),z.tasks.size!==0&&z.tick(fe)}function ye(a){let t;return z.tasks.size===0&&z.tick(fe),{promise:new Promise(s=>{z.tasks.add(t={c:a,f:s})}),abort(){z.tasks.delete(t)}}}function _e(a){if(a==="float")return"cssFloat";if(a==="offset")return"cssOffset";if(a.startsWith("--"))return a;const t=a.split("-");return t.length===1?t[0]:t[0]+t.slice(1).map(s=>s[0].toUpperCase()+s.slice(1)).join("")}function ne(a){const t={},s=a.split(";");for(const l of s){const[i,d]=l.split(":");if(!i||d===void 0)break;const v=_e(i.trim());t[v]=d.trim()}return t}const we=a=>a;function ke(a,t,s){var l=me,i,d,v,w=null;l.a??(l.a={element:a,measure(){i=this.element.getBoundingClientRect()},apply(){if(v==null||v.abort(),d=this.element.getBoundingClientRect(),i.left!==d.left||i.right!==d.right||i.top!==d.top||i.bottom!==d.bottom){const g=t()(this.element,{from:i,to:d},s==null?void 0:s());v=ve(this.element,g,void 0,1,()=>{v==null||v.abort(),v=void 0})}},fix(){if(!a.getAnimations().length){var{position:g,width:j,height:P}=getComputedStyle(a);if(g!=="absolute"&&g!=="fixed"){var b=a.style;w={position:b.position,width:b.width,height:b.height,transform:b.transform},b.position="absolute",b.width=j,b.height=P;var F=a.getBoundingClientRect();if(i.left!==F.left||i.top!==F.top){var k=`translate(${i.left-F.left}px, ${i.top-F.top}px)`;b.transform=b.transform?`${b.transform} ${k}`:k}}}},unfix(){if(w){var g=a.style;g.position=w.position,g.width=w.width,g.height=w.height,g.transform=w.transform}}}),l.a.element=a}function ve(a,t,s,l,i){if(pe(t)){var d,v=!1;return ge(()=>{if(!v){var D=t({direction:"in"});d=ve(a,D,s,l,i)}}),{abort:()=>{v=!0,d==null||d.abort()},deactivate:()=>d.deactivate(),reset:()=>d.reset(),t:()=>d.t()}}if(!(t!=null&&t.duration))return i(),{abort:V,deactivate:V,reset:V,t:()=>l};const{delay:w=0,css:g,tick:j,easing:P=we}=t;var b=[];if(j&&j(0,1),g){var F=ne(g(0,1));b.push(F,F)}var k=()=>1-l,p=a.animate(b,{duration:w,fill:"forwards"});return p.onfinish=()=>{p.cancel();var D=1-l,x=l-D,T=t.duration*Math.abs(x),U=[];if(T>0){var I=!1;if(g)for(var c=Math.ceil(T/16.666666666666668),m=0;m<=c;m+=1){var r=D+x*P(m/c),e=ne(g(r,1-r));U.push(e),I||(I=e.overflow==="hidden")}I&&(a.style.overflow="hidden"),k=()=>{var n=p.currentTime;return D+x*P(n/T)},j&&ye(()=>{if(p.playState!=="running")return!1;var n=k();return j(n,1-n),!0})}p=a.animate(U,{duration:T,fill:"forwards"}),p.onfinish=()=>{k=()=>l,j==null||j(l,1-l),i()}},{abort:()=>{p&&(p.cancel(),p.effect=null,p.onfinish=V)},deactivate:()=>{i=V},reset:()=>{},t:()=>k()}}function Se(a,t){const s=a.target,l=Array.from(s.files||[]);t(l)}var De=E('<div class="bg-gray-50 rounded-lg p-3"><div class="flex items-center justify-between mb-2"><span class="text-sm text-gray-700 truncate flex-1 mr-2"> </span> <span> </span></div> <div class="bg-gray-200 rounded-full h-2"><div></div></div></div>'),Te=E('<div class="mt-4 space-y-2"></div>'),je=E('<div><div class="space-y-1 text-center"><svg class="mx-auto h-12 w-12 text-gray-400" stroke="currentColor" fill="none" viewBox="0 0 48 48"><path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path></svg> <div class="flex text-sm text-gray-600"><label for="file-upload" class="relative cursor-pointer rounded-md font-medium text-indigo-600 hover:text-indigo-500 focus-within:outline-none focus-within:ring-2 focus-within:ring-offset-2 focus-within:ring-indigo-500"><span>Upload files</span> <input id="file-upload" name="file-upload" type="file" class="sr-only" multiple accept="image/*,.heic"/></label> <p class="pl-1">or drag and drop</p></div> <p class="text-xs text-gray-500">PNG, JPG, GIF, HEIC up to 100MB each</p> <!></div></div>');function at(a,t){ae(t,!0);const s=re();let l=R(!1),i=R(de([])),d,v=0;function w(c){c.preventDefault(),S(l,!0)}function g(){S(l,!1)}function j(c){var r;c.preventDefault(),S(l,!1);const m=Array.from(((r=c.dataTransfer)==null?void 0:r.files)||[]);P(m)}async function P(c){const m=c.filter(e=>e.type.startsWith("image/")||e.name.toLowerCase().endsWith(".heic"));if(m.length===0){alert("Please select image files only");return}const r=m.map(e=>({file:e,id:`upload_${v++}`,progress:0,status:"pending"}));o(i).push(...r),b()}async function b(){const c=o(i).filter(n=>n.status==="pending"),m=3,r=o(i).filter(n=>n.status==="uploading").length,e=Math.min(m-r,c.length);for(let n=0;n<e;n++){const h=c[n];h.status="uploading",F(h)}}async function F(c){const m=new FormData;m.append("images",c.file);try{const r=new XMLHttpRequest;r.upload.addEventListener("progress",e=>{e.lengthComputable&&(c.progress=e.loaded/e.total*100,S(i,o(i),!0))}),r.addEventListener("load",()=>{r.status===200?(c.status="completed",c.progress=100,setTimeout(()=>{S(i,o(i).filter(e=>e.id!==c.id),!0),o(i).every(e=>e.status==="completed"||e.status==="error")&&(s("uploaded"),d.value="")},1e3),b()):(c.status="error",console.error("Upload failed:",r.responseText)),S(i,o(i),!0)}),r.addEventListener("error",()=>{c.status="error",S(i,o(i),!0),console.error("Upload error for file:",c.file.name),b()}),r.open("POST",`${B()}/api/upload/${t.projectId}/images`),r.send(m)}catch(r){console.error("Upload error:",r),c.status="error",S(i,o(i),!0),b()}}var k=je(),p=f(k),D=_(f(p),2),x=f(D),T=_(f(x),2);T.__change=[Se,P],ce(T,c=>d=c,()=>d),u(x),Z(2),u(D);var U=_(D,4);{var I=c=>{var m=Te();le(m,21,()=>o(i),r=>r.id,(r,e)=>{var n=De(),h=f(n),M=f(h),y=f(M,!0);u(M);var $=_(M,2),Y=f($,!0);u($),u(h);var G=_(h,2),N=f(G);u(G),u(n),O(()=>{W(y,o(e).file.name),Q($,1,`text-xs px-2 py-1 rounded-full ${o(e).status==="uploading"?"bg-blue-100 text-blue-800":o(e).status==="completed"?"bg-green-100 text-green-800":o(e).status==="error"?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"}`),W(Y,o(e).status==="uploading"?"Uploading":o(e).status==="completed"?"Complete":o(e).status==="error"?"Error":"Pending"),Q(N,1,`h-2 rounded-full transition-all duration-300 ${o(e).status==="completed"?"bg-green-500":o(e).status==="error"?"bg-red-500":"bg-blue-500"}`),be(N,`width: ${o(e).progress??""}%`)}),A(r,n)}),u(m),A(c,m)};H(U,c=>{o(i).length>0&&c(I)})}u(p),u(k),O(()=>Q(k,1,`mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-dashed rounded-lg transition-colors ${o(l)?"border-indigo-400 bg-indigo-50":"border-gray-300"}`)),J("dragover",k,w),J("dragleave",k,g),J("drop",k,j),A(a,k),ie()}te(["change"]);function Ue(a){const t=a-1;return t*t*t+1}function Ce(a){return--a*a*a*a*a+1}function Ie(a,{from:t,to:s},l={}){var{delay:i=0,duration:d=r=>Math.sqrt(r)*120,easing:v=Ue}=l,w=getComputedStyle(a),g=w.transform==="none"?"":w.transform,[j,P]=w.transformOrigin.split(" ").map(parseFloat);j/=a.clientWidth,P/=a.clientHeight;var b=Pe(a),F=a.clientWidth/s.width/b,k=a.clientHeight/s.height/b,p=t.left+t.width*j,D=t.top+t.height*P,x=s.left+s.width*j,T=s.top+s.height*P,U=(p-x)*F,I=(D-T)*k,c=t.width/s.width,m=t.height/s.height;return{delay:i,duration:typeof d=="function"?d(Math.sqrt(U*U+I*I)):d,easing:v,css:(r,e)=>{var n=e*U,h=e*I,M=r+e*c,y=r+e*m;return`transform: ${g} translate(${n}px, ${h}px) scale(${M}, ${y});`}}}function Pe(a){if("currentCSSZoom"in a)return a.currentCSSZoom;for(var t=a,s=1;t!==null;)s*=+getComputedStyle(t).zoom,t=t.parentElement;return s}async function Me(a,t,s,l){if(o(t).size===0||!confirm(`Delete ${o(t).size} selected images?`))return;const i=Array.from(o(t)).map(d=>fetch(`${B()}/api/upload/${s().id}/files/${d}`,{method:"DELETE"}));try{await Promise.all(i),o(t).clear(),l("updated")}catch(d){console.error("Failed to delete images:",d)}}var $e=E('<button class="inline-flex items-center px-3 py-1 border border-transparent text-sm font-medium rounded-md text-white bg-red-600 hover:bg-red-700"> </button>'),Fe=(a,t)=>t("add-more"),Ae=(a,t,s)=>t(s),Ee=E('<div class="absolute inset-0 bg-indigo-600 bg-opacity-20 rounded-lg"></div>'),Le=E('<div draggable="true" class="relative group cursor-move"><div class="aspect-square overflow-hidden rounded-lg bg-gray-100"><img class="w-full h-full object-cover group-hover:opacity-75 transition-opacity"/></div> <div class="absolute top-2 left-2"><input type="checkbox" class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded"/></div> <!> <div class="absolute bottom-2 right-2 bg-black bg-opacity-50 text-white text-xs px-2 py-1 rounded"> </div></div>'),Oe=E('<div class="space-y-4"><div class="flex justify-between items-center"><div class="flex items-center space-x-4"><span class="text-sm text-gray-500"> </span> <!></div> <button class="inline-flex items-center px-3 py-1 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50"><svg class="h-4 w-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg> Add More</button></div> <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-4"></div> <p class="text-sm text-gray-500 text-center">Drag and drop images to reorder them</p></div>');function it(a,t){ae(t,!0);let s=ue(t,"project",7);const l=re();let i=R(de(new Set)),d=R(!1),v=R(null);function w(r){const e=typeof r=="string"?r:r.name;o(i).has(e)?o(i).delete(e):o(i).add(e),S(i,new Set(o(i)),!0)}function g(r,e){const n=typeof e=="string"?e:e.name;S(v,n,!0),r.dataTransfer&&(r.dataTransfer.effectAllowed="move")}function j(r){r.preventDefault(),r.dataTransfer&&(r.dataTransfer.dropEffect="move")}function P(r,e){r.preventDefault();const n=typeof e=="string"?e:e.name;if(!o(v)||o(v)===n)return;const h=s().images.findIndex(y=>(typeof y=="string"?y:y.name)===o(v)),M=s().images.findIndex(y=>(typeof y=="string"?y:y.name)===n);if(h!==-1&&M!==-1){const y=[...s().images],$=y.splice(h,1)[0];y.splice(M,0,$),b(y)}S(v,null)}async function b(r){S(d,!0);try{const e=r.map(h=>typeof h=="string"?h:h.name);(await fetch(`${B()}/api/projects/${s().id}/reorder`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({images:e})})).ok&&(s().images=r)}catch(e){console.error("Failed to save new order:",e)}finally{S(d,!1)}}function F(r){const e=typeof r=="string"?r:r.name;return`${B()}/api/files/${s().id}/${e}`}var k=Oe(),p=f(k),D=f(p),x=f(D),T=f(x);u(x);var U=_(x,2);{var I=r=>{var e=$e();e.__click=[Me,i,s,l];var n=f(e);u(e),O(()=>W(n,`Delete ${o(i).size??""} selected`)),A(r,e)};H(U,r=>{o(i).size>0&&r(I)})}u(D);var c=_(D,2);c.__click=[Fe,l],u(p);var m=_(p,2);le(m,28,()=>s().images,r=>r,(r,e)=>{var n=Le(),h=f(n),M=f(h);u(h);var y=_(h,2),$=f(y);K($),$.__change=[Ae,w,e],u(y);var Y=_(y,2);{var G=C=>{var q=Ee();A(C,q)};H(Y,C=>{o(d)&&o(v)===(typeof e=="string"?e:e.name)&&C(G)})}var N=_(Y,2),L=f(N,!0);u(N),u(n),O((C,q,X)=>{ee(M,"src",C),ee(M,"alt",typeof e=="string"?e:e.name),he($,q),W(L,X)},[()=>F(e),()=>o(i).has(typeof e=="string"?e:e.name),()=>s().images.findIndex(C=>(typeof C=="string"?C:C.name)===(typeof e=="string"?e:e.name))+1]),J("dragstart",n,C=>g(C,e)),J("dragover",n,j),J("drop",n,C=>P(C,e)),ke(n,()=>Ie,()=>({duration:300,easing:Ce})),A(r,n)}),u(m),Z(2),u(k),O(()=>W(T,`${s().images.length??""} images`)),A(a,k),ie()}te(["click","change"]);async function ze(a,t,s,l,i,d,v){if(!o(t).trim()){alert("Please enter a YouTube URL");return}S(s,!0);try{if((await fetch(`${B()}/api/uploads/${l.projectId}/youtube`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:o(t)})})).ok){const g=await fetch(`${B()}/api/uploads/${l.projectId}/youtube-download`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:o(t),startTime:i()?"0:00":o(d)||"0:00"})});if(g.ok)v("uploaded"),S(t,""),S(d,"0:00");else{const j=await g.json();alert(`Download failed: ${j.error||"Unknown error"}`)}}else alert("Invalid YouTube URL. Please try again.")}catch(w){console.error("YouTube error:",w),alert("Failed to process YouTube URL. Please try again.")}finally{S(s,!1)}}async function Re(a,t,s){if(confirm("Delete the audio file?"))try{(await fetch(`${B()}/api/uploads/${t.projectId}/files/${t.audioFile}`,{method:"DELETE"})).ok&&s("uploaded")}catch(l){console.error("Failed to delete audio:",l)}}var Be=E('<div class="flex items-center justify-between"><div class="flex items-center space-x-4"><svg class="h-10 w-10 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"></path></svg> <div><p class="text-sm font-medium text-gray-900">Audio uploaded</p> <p class="text-sm text-gray-500"> </p></div></div> <button class="text-sm font-medium text-red-600 hover:text-red-500">Remove</button></div> <audio controls class="w-full mt-4"><source/></audio>',1),Ne=(a,t)=>S(t,"file"),qe=(a,t)=>S(t,"youtube"),He=E('<div class="mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-dashed border-gray-300 rounded-lg"><div class="space-y-1 text-center"><svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"></path></svg> <div class="flex text-sm text-gray-600"><label for="audio-upload" class="relative cursor-pointer rounded-md font-medium text-indigo-600 hover:text-indigo-500"><span>Upload audio file</span> <input id="audio-upload" type="file" class="sr-only" accept="audio/*,.mp3,.wav,.m4a,.aac"/></label></div> <p class="text-xs text-gray-500">MP3, WAV, M4A, or AAC</p></div></div>'),We=E('<div><label for="start-time" class="block text-sm font-medium text-gray-700 mb-2">Start Time (optional)</label> <input id="start-time" type="text" placeholder="0:00 (mm:ss or hh:mm:ss)" class="block w-full rounded-md border-0 py-1.5 px-3 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6"/> <p class="text-xs text-gray-500 mt-1">Specify where to start extracting audio (default: 0:00)</p></div>'),Ye=E('<div class="text-sm text-gray-600 bg-gray-50 p-3 rounded-md"><p class="font-medium mb-1">Processing steps:</p> <ul class="list-disc list-inside space-y-1 text-xs"><li>Downloading audio with yt-dlp</li> <li>Converting audio to MP3 with ffmpeg</li> <li>Detecting downbeats with madmom</li></ul> <p class="text-xs text-gray-500 mt-2">Check Docker terminal for detailed logs</p></div>'),Ge=E('<div class="space-y-4"><div><label for="youtube-url" class="block text-sm font-medium text-gray-700 mb-2">YouTube URL</label> <input id="youtube-url" type="text" placeholder="https://www.youtube.com/watch?v=..." class="block w-full rounded-md border-0 py-1.5 px-3 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6"/></div> <!> <button class="w-full inline-flex justify-center items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed"> </button> <!></div>'),Je=E('<div class="flex space-x-4 mb-4"><button>Upload File</button> <button>YouTube URL</button></div> <!>',1),Ve=E('<div class="bg-white rounded-lg border border-gray-200 p-6"><!></div>');function ot(a,t){ae(t,!0);let s=ue(t,"hideStartTime",3,!1);const l=re();let i=R(!1),d=R("file"),v=R(""),w=R("0:00"),g;async function j(p){var U;const x=(U=p.target.files)==null?void 0:U[0];if(!x)return;if(!x.type.startsWith("audio/")&&!x.name.match(/\.(mp3|wav|m4a|aac)$/i)){alert("Please select an audio file");return}S(i,!0);const T=new FormData;T.append("audio",x);try{(await fetch(`${B()}/api/uploads/${t.projectId}/audio`,{method:"POST",body:T})).ok?l("uploaded"):alert("Upload failed. Please try again.")}catch(I){console.error("Upload error:",I),alert("Upload failed. Please try again.")}finally{S(i,!1),g.value=""}}var P=Ve(),b=f(P);{var F=p=>{var D=Be(),x=oe(D),T=f(x),U=_(f(T),2),I=_(f(U),2),c=f(I,!0);u(I),u(U),u(T);var m=_(T,2);m.__click=[Re,t,l],u(x);var r=_(x,2),e=f(r);u(r),O(n=>{W(c,t.audioFile),ee(e,"src",`${n??""}/api/files/${t.projectId??""}/${t.audioFile??""}`)},[B]),A(p,D)},k=p=>{var D=Je(),x=oe(D),T=f(x);T.__click=[Ne,d];var U=_(T,2);U.__click=[qe,d],u(x);var I=_(x,2);{var c=r=>{var e=He(),n=f(e),h=_(f(n),2),M=f(h),y=_(f(M),2);y.__change=j,ce(y,$=>g=$,()=>g),u(M),u(h),Z(2),u(n),u(e),O(()=>y.disabled=o(i)),A(r,e)},m=r=>{var e=Ge(),n=f(e),h=_(f(n),2);K(h),u(n);var M=_(n,2);{var y=L=>{var C=We(),q=_(f(C),2);K(q),Z(2),u(C),O(()=>q.disabled=o(i)),se(q,()=>o(w),X=>S(w,X)),A(L,C)};H(M,L=>{s()||L(y)})}var $=_(M,2);$.__click=[ze,v,i,t,s,w,l];var Y=f($,!0);u($);var G=_($,2);{var N=L=>{var C=Ye();A(L,C)};H(G,L=>{o(i)&&L(N)})}u(e),O(L=>{h.disabled=o(i),$.disabled=L,W(Y,o(i)?"Processing (yt-dlp + ffmpeg + madmom)...":"Download & Process Audio")},[()=>o(i)||!o(v).trim()]),se(h,()=>o(v),L=>S(v,L)),A(r,e)};H(I,r=>{o(d)==="file"?r(c):r(m,!1)})}O(()=>{Q(T,1,`flex-1 py-2 px-4 border rounded-md text-sm font-medium ${o(d)==="file"?"border-indigo-500 text-indigo-600 bg-indigo-50":"border-gray-300 text-gray-700 bg-white hover:bg-gray-50"}`),Q(U,1,`flex-1 py-2 px-4 border rounded-md text-sm font-medium ${o(d)==="youtube"?"border-indigo-500 text-indigo-600 bg-indigo-50":"border-gray-300 text-gray-700 bg-white hover:bg-gray-50"}`)}),A(p,D)};H(b,p=>{t.hasAudio&&t.audioFile?p(F):p(k,!1)})}u(P),A(a,P),ie()}te(["click","change"]);export{ot as A,at as I,it as a};
