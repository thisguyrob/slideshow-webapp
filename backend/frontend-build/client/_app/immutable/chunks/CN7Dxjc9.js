import"./CWj6FrbW.js";import{d as te,c as re,e as H,s as W}from"./BVW34SQx.js";import{aD as fe,G as ve,I as Y,p as ae,e as L,h as f,i as k,r as u,a0 as V,g as d,d as z,t as O,a as E,b as ie,s as x,B as pe,f as oe}from"./CNfditUa.js";import{i as q}from"./GC4dxQQb.js";import{f as ge,s as K,g as B,e as me,r as Q,a as ee,h as he,b as se}from"./BEFEBz6G.js";import{s as be}from"./Cty7KhZ4.js";import{b as de,p as le}from"./0rDqRz2G.js";const ye=()=>performance.now(),R={tick:t=>requestAnimationFrame(t),now:()=>ye(),tasks:new Set};function ce(){const t=R.now();R.tasks.forEach(e=>{e.c(t)||(R.tasks.delete(e),e.f())}),R.tasks.size!==0&&R.tick(ce)}function xe(t){let e;return R.tasks.size===0&&R.tick(ce),{promise:new Promise(i=>{R.tasks.add(e={c:t,f:i})}),abort(){R.tasks.delete(e)}}}function _e(t){if(t==="float")return"cssFloat";if(t==="offset")return"cssOffset";if(t.startsWith("--"))return t;const e=t.split("-");return e.length===1?e[0]:e[0]+e.slice(1).map(i=>i[0].toUpperCase()+i.slice(1)).join("")}function ne(t){const e={},i=t.split(";");for(const n of i){const[o,s]=n.split(":");if(!o||s===void 0)break;const l=_e(o.trim());e[l]=s.trim()}return e}const we=t=>t;function ke(t,e,i){var n=ge,o,s,l,_=null;n.a??(n.a={element:t,measure(){o=this.element.getBoundingClientRect()},apply(){if(l==null||l.abort(),s=this.element.getBoundingClientRect(),o.left!==s.left||o.right!==s.right||o.top!==s.top||o.bottom!==s.bottom){const h=e()(this.element,{from:o,to:s},i==null?void 0:i());l=ue(this.element,h,void 0,1,()=>{l==null||l.abort(),l=void 0})}},fix(){if(!t.getAnimations().length){var{position:h,width:S,height:M}=getComputedStyle(t);if(h!=="absolute"&&h!=="fixed"){var p=t.style;_={position:p.position,width:p.width,height:p.height,transform:p.transform},p.position="absolute",p.width=S,p.height=M;var U=t.getBoundingClientRect();if(o.left!==U.left||o.top!==U.top){var j=`translate(${o.left-U.left}px, ${o.top-U.top}px)`;p.transform=p.transform?`${p.transform} ${j}`:j}}}},unfix(){if(_){var h=t.style;h.position=_.position,h.width=_.width,h.height=_.height,h.transform=_.transform}}}),n.a.element=t}function ue(t,e,i,n,o){if(fe(e)){var s,l=!1;return ve(()=>{if(!l){var D=e({direction:"in"});s=ue(t,D,i,n,o)}}),{abort:()=>{l=!0,s==null||s.abort()},deactivate:()=>s.deactivate(),reset:()=>s.reset(),t:()=>s.t()}}if(!(e!=null&&e.duration))return o(),{abort:Y,deactivate:Y,reset:Y,t:()=>n};const{delay:_=0,css:h,tick:S,easing:M=we}=e;var p=[];if(S&&S(0,1),h){var U=ne(h(0,1));p.push(U,U)}var j=()=>1-n,g=t.animate(p,{duration:_,fill:"forwards"});return g.onfinish=()=>{g.cancel();var D=1-n,y=n-D,T=e.duration*Math.abs(y),v=[];if(T>0){var b=!1;if(h)for(var P=Math.ceil(T/16.666666666666668),m=0;m<=P;m+=1){var a=D+y*M(m/P),r=ne(h(a,1-a));v.push(r),b||(b=r.overflow==="hidden")}b&&(t.style.overflow="hidden"),j=()=>{var c=g.currentTime;return D+y*M(c/T)},S&&xe(()=>{if(g.playState!=="running")return!1;var c=j();return S(c,1-c),!0})}g=t.animate(v,{duration:T,fill:"forwards"}),g.onfinish=()=>{j=()=>n,S==null||S(n,1-n),o()}},{abort:()=>{g&&(g.cancel(),g.effect=null,g.onfinish=Y)},deactivate:()=>{o=Y},reset:()=>{},t:()=>j()}}function De(t,e){const i=t.target,n=Array.from(i.files||[]);e(n)}var Se=L('<div class="mt-4"><div class="bg-gray-200 rounded-full h-2 w-48 mx-auto"><div class="bg-indigo-600 h-2 rounded-full transition-all duration-300"></div></div> <p class="text-sm text-gray-600 mt-2"> </p></div>'),Te=L('<div><div class="space-y-1 text-center"><svg class="mx-auto h-12 w-12 text-gray-400" stroke="currentColor" fill="none" viewBox="0 0 48 48"><path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path></svg> <div class="flex text-sm text-gray-600"><label for="file-upload" class="relative cursor-pointer rounded-md font-medium text-indigo-600 hover:text-indigo-500 focus-within:outline-none focus-within:ring-2 focus-within:ring-offset-2 focus-within:ring-indigo-500"><span>Upload files</span> <input id="file-upload" name="file-upload" type="file" class="sr-only" multiple accept="image/*,.heic"/></label> <p class="pl-1">or drag and drop</p></div> <p class="text-xs text-gray-500">PNG, JPG, GIF, HEIC up to 100MB each</p> <!></div></div>');function rt(t,e){ae(e,!0);const i=re();let n=z(!1),o=z(!1),s=z(0),l;function _(v){v.preventDefault(),x(n,!0)}function h(){x(n,!1)}function S(v){var P;v.preventDefault(),x(n,!1);const b=Array.from(((P=v.dataTransfer)==null?void 0:P.files)||[]);M(b)}async function M(v){const b=v.filter(m=>m.type.startsWith("image/")||m.name.toLowerCase().endsWith(".heic"));if(b.length===0){alert("Please select image files only");return}x(o,!0),x(s,0);const P=new FormData;b.forEach(m=>{P.append("images",m)});try{const m=new XMLHttpRequest;m.upload.addEventListener("progress",a=>{a.lengthComputable&&x(s,a.loaded/a.total*100)}),m.addEventListener("load",()=>{m.status===200?(i("uploaded"),l.value=""):alert("Upload failed. Please try again."),x(o,!1)}),m.addEventListener("error",()=>{alert("Upload failed. Please try again."),x(o,!1)}),m.open("POST",`${B()}/api/upload/${e.projectId}/images`),m.send(P)}catch(m){console.error("Upload error:",m),alert("Upload failed. Please try again."),x(o,!1)}}var p=Te(),U=f(p),j=k(f(U),2),g=f(j),D=k(f(g),2);D.__change=[De,M],de(D,v=>l=v,()=>l),u(g),V(2),u(j);var y=k(j,4);{var T=v=>{var b=Se(),P=f(b),m=f(P);u(P);var a=k(P,2),r=f(a);u(a),u(b),O(c=>{be(m,`width: ${d(s)??""}%`),W(r,`Uploading... ${c??""}%`)},[()=>Math.round(d(s))]),E(v,b)};q(y,v=>{d(o)&&v(T)})}u(U),u(p),O(()=>{K(p,1,`mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-dashed rounded-lg transition-colors ${d(n)?"border-indigo-400 bg-indigo-50":"border-gray-300"}`),D.disabled=d(o)}),H("dragover",p,_),H("dragleave",p,h),H("drop",p,S),E(t,p),ie()}te(["change"]);function Pe(t){const e=t-1;return e*e*e+1}function je(t){return--t*t*t*t*t+1}function Ce(t,{from:e,to:i},n={}){var{delay:o=0,duration:s=a=>Math.sqrt(a)*120,easing:l=Pe}=n,_=getComputedStyle(t),h=_.transform==="none"?"":_.transform,[S,M]=_.transformOrigin.split(" ").map(parseFloat);S/=t.clientWidth,M/=t.clientHeight;var p=Ie(t),U=t.clientWidth/i.width/p,j=t.clientHeight/i.height/p,g=e.left+e.width*S,D=e.top+e.height*M,y=i.left+i.width*S,T=i.top+i.height*M,v=(g-y)*U,b=(D-T)*j,P=e.width/i.width,m=e.height/i.height;return{delay:o,duration:typeof s=="function"?s(Math.sqrt(v*v+b*b)):s,easing:l,css:(a,r)=>{var c=r*v,C=r*b,A=a+r*P,w=a+r*m;return`transform: ${h} translate(${c}px, ${C}px) scale(${A}, ${w});`}}}function Ie(t){if("currentCSSZoom"in t)return t.currentCSSZoom;for(var e=t,i=1;e!==null;)i*=+getComputedStyle(e).zoom,e=e.parentElement;return i}async function Me(t,e,i,n){if(d(e).size===0||!confirm(`Delete ${d(e).size} selected images?`))return;const o=Array.from(d(e)).map(s=>fetch(`${B()}/api/upload/${i().id}/files/${s}`,{method:"DELETE"}));try{await Promise.all(o),d(e).clear(),n("updated")}catch(s){console.error("Failed to delete images:",s)}}var Ue=L('<button class="inline-flex items-center px-3 py-1 border border-transparent text-sm font-medium rounded-md text-white bg-red-600 hover:bg-red-700"> </button>'),Ae=(t,e)=>e("add-more"),Fe=(t,e,i)=>e(i),$e=L('<div class="absolute inset-0 bg-indigo-600 bg-opacity-20 rounded-lg"></div>'),Ee=L('<div draggable="true" class="relative group cursor-move"><div class="aspect-square overflow-hidden rounded-lg bg-gray-100"><img class="w-full h-full object-cover group-hover:opacity-75 transition-opacity"/></div> <div class="absolute top-2 left-2"><input type="checkbox" class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded"/></div> <!> <div class="absolute bottom-2 right-2 bg-black bg-opacity-50 text-white text-xs px-2 py-1 rounded"> </div></div>'),Le=L('<div class="space-y-4"><div class="flex justify-between items-center"><div class="flex items-center space-x-4"><span class="text-sm text-gray-500"> </span> <!></div> <button class="inline-flex items-center px-3 py-1 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50"><svg class="h-4 w-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg> Add More</button></div> <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-4"></div> <p class="text-sm text-gray-500 text-center">Drag and drop images to reorder them</p></div>');function at(t,e){ae(e,!0);let i=le(e,"project",7);const n=re();let o=z(pe(new Set)),s=z(!1),l=z(null);function _(a){const r=typeof a=="string"?a:a.name;d(o).has(r)?d(o).delete(r):d(o).add(r),x(o,new Set(d(o)),!0)}function h(a,r){const c=typeof r=="string"?r:r.name;x(l,c,!0),a.dataTransfer&&(a.dataTransfer.effectAllowed="move")}function S(a){a.preventDefault(),a.dataTransfer&&(a.dataTransfer.dropEffect="move")}function M(a,r){a.preventDefault();const c=typeof r=="string"?r:r.name;if(!d(l)||d(l)===c)return;const C=i().images.findIndex(w=>(typeof w=="string"?w:w.name)===d(l)),A=i().images.findIndex(w=>(typeof w=="string"?w:w.name)===c);if(C!==-1&&A!==-1){const w=[...i().images],F=w.splice(C,1)[0];w.splice(A,0,F),p(w)}x(l,null)}async function p(a){x(s,!0);try{const r=a.map(C=>typeof C=="string"?C:C.name);(await fetch(`${B()}/api/projects/${i().id}/reorder`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({images:r})})).ok&&(i().images=a)}catch(r){console.error("Failed to save new order:",r)}finally{x(s,!1)}}function U(a){const r=typeof a=="string"?a:a.name;return`${B()}/api/files/${i().id}/${r}`}var j=Le(),g=f(j),D=f(g),y=f(D),T=f(y);u(y);var v=k(y,2);{var b=a=>{var r=Ue();r.__click=[Me,o,i,n];var c=f(r);u(r),O(()=>W(c,`Delete ${d(o).size??""} selected`)),E(a,r)};q(v,a=>{d(o).size>0&&a(b)})}u(D);var P=k(D,2);P.__click=[Ae,n],u(g);var m=k(g,2);me(m,28,()=>i().images,a=>a,(a,r)=>{var c=Ee(),C=f(c),A=f(C);u(C);var w=k(C,2),F=f(w);Q(F),F.__change=[Fe,_,r],u(w);var G=k(w,2);{var Z=I=>{var N=$e();E(I,N)};q(G,I=>{d(s)&&d(l)===(typeof r=="string"?r:r.name)&&I(Z)})}var J=k(G,2),$=f(J,!0);u(J),u(c),O((I,N,X)=>{ee(A,"src",I),ee(A,"alt",typeof r=="string"?r:r.name),he(F,N),W($,X)},[()=>U(r),()=>d(o).has(typeof r=="string"?r:r.name),()=>i().images.findIndex(I=>(typeof I=="string"?I:I.name)===(typeof r=="string"?r:r.name))+1]),H("dragstart",c,I=>h(I,r)),H("dragover",c,S),H("drop",c,I=>M(I,r)),ke(c,()=>Ce,()=>({duration:300,easing:je})),E(a,c)}),u(m),V(2),u(j),O(()=>W(T,`${i().images.length??""} images`)),E(t,j),ie()}te(["click","change"]);async function Oe(t,e,i,n,o,s,l){if(!d(e).trim()){alert("Please enter a YouTube URL");return}x(i,!0);try{if((await fetch(`${B()}/api/uploads/${n.projectId}/youtube`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:d(e)})})).ok){const h=await fetch(`${B()}/api/uploads/${n.projectId}/youtube-download`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:d(e),startTime:o()?"0:00":d(s)||"0:00"})});if(h.ok)l("uploaded"),x(e,""),x(s,"0:00");else{const S=await h.json();alert(`Download failed: ${S.error||"Unknown error"}`)}}else alert("Invalid YouTube URL. Please try again.")}catch(_){console.error("YouTube error:",_),alert("Failed to process YouTube URL. Please try again.")}finally{x(i,!1)}}async function ze(t,e,i){if(confirm("Delete the audio file?"))try{(await fetch(`${B()}/api/uploads/${e.projectId}/files/${e.audioFile}`,{method:"DELETE"})).ok&&i("uploaded")}catch(n){console.error("Failed to delete audio:",n)}}var Re=L('<div class="flex items-center justify-between"><div class="flex items-center space-x-4"><svg class="h-10 w-10 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"></path></svg> <div><p class="text-sm font-medium text-gray-900">Audio uploaded</p> <p class="text-sm text-gray-500"> </p></div></div> <button class="text-sm font-medium text-red-600 hover:text-red-500">Remove</button></div> <audio controls class="w-full mt-4"><source/></audio>',1),Be=(t,e)=>x(e,"file"),Ne=(t,e)=>x(e,"youtube"),qe=L('<div class="mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-dashed border-gray-300 rounded-lg"><div class="space-y-1 text-center"><svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"></path></svg> <div class="flex text-sm text-gray-600"><label for="audio-upload" class="relative cursor-pointer rounded-md font-medium text-indigo-600 hover:text-indigo-500"><span>Upload audio file</span> <input id="audio-upload" type="file" class="sr-only" accept="audio/*,.mp3,.wav,.m4a,.aac"/></label></div> <p class="text-xs text-gray-500">MP3, WAV, M4A, or AAC</p></div></div>'),He=L('<div><label for="start-time" class="block text-sm font-medium text-gray-700 mb-2">Start Time (optional)</label> <input id="start-time" type="text" placeholder="0:00 (mm:ss or hh:mm:ss)" class="block w-full rounded-md border-0 py-1.5 px-3 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6"/> <p class="text-xs text-gray-500 mt-1">Specify where to start extracting audio (default: 0:00)</p></div>'),We=L('<div class="text-sm text-gray-600 bg-gray-50 p-3 rounded-md"><p class="font-medium mb-1">Processing steps:</p> <ul class="list-disc list-inside space-y-1 text-xs"><li>Downloading audio with yt-dlp</li> <li>Converting audio to MP3 with ffmpeg</li> <li>Detecting downbeats with madmom</li></ul> <p class="text-xs text-gray-500 mt-2">Check Docker terminal for detailed logs</p></div>'),Ye=L('<div class="space-y-4"><div><label for="youtube-url" class="block text-sm font-medium text-gray-700 mb-2">YouTube URL</label> <input id="youtube-url" type="text" placeholder="https://www.youtube.com/watch?v=..." class="block w-full rounded-md border-0 py-1.5 px-3 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6"/></div> <!> <button class="w-full inline-flex justify-center items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed"> </button> <!></div>'),Ge=L('<div class="flex space-x-4 mb-4"><button>Upload File</button> <button>YouTube URL</button></div> <!>',1),Je=L('<div class="bg-white rounded-lg border border-gray-200 p-6"><!></div>');function it(t,e){ae(e,!0);let i=le(e,"hideStartTime",3,!1);const n=re();let o=z(!1),s=z("file"),l=z(""),_=z("0:00"),h;async function S(g){var v;const y=(v=g.target.files)==null?void 0:v[0];if(!y)return;if(!y.type.startsWith("audio/")&&!y.name.match(/\.(mp3|wav|m4a|aac)$/i)){alert("Please select an audio file");return}x(o,!0);const T=new FormData;T.append("audio",y);try{(await fetch(`${B()}/api/uploads/${e.projectId}/audio`,{method:"POST",body:T})).ok?n("uploaded"):alert("Upload failed. Please try again.")}catch(b){console.error("Upload error:",b),alert("Upload failed. Please try again.")}finally{x(o,!1),h.value=""}}var M=Je(),p=f(M);{var U=g=>{var D=Re(),y=oe(D),T=f(y),v=k(f(T),2),b=k(f(v),2),P=f(b,!0);u(b),u(v),u(T);var m=k(T,2);m.__click=[ze,e,n],u(y);var a=k(y,2),r=f(a);u(a),O(c=>{W(P,e.audioFile),ee(r,"src",`${c??""}/api/files/${e.projectId??""}/${e.audioFile??""}`)},[B]),E(g,D)},j=g=>{var D=Ge(),y=oe(D),T=f(y);T.__click=[Be,s];var v=k(T,2);v.__click=[Ne,s],u(y);var b=k(y,2);{var P=a=>{var r=qe(),c=f(r),C=k(f(c),2),A=f(C),w=k(f(A),2);w.__change=S,de(w,F=>h=F,()=>h),u(A),u(C),V(2),u(c),u(r),O(()=>w.disabled=d(o)),E(a,r)},m=a=>{var r=Ye(),c=f(r),C=k(f(c),2);Q(C),u(c);var A=k(c,2);{var w=$=>{var I=He(),N=k(f(I),2);Q(N),V(2),u(I),O(()=>N.disabled=d(o)),se(N,()=>d(_),X=>x(_,X)),E($,I)};q(A,$=>{i()||$(w)})}var F=k(A,2);F.__click=[Oe,l,o,e,i,_,n];var G=f(F,!0);u(F);var Z=k(F,2);{var J=$=>{var I=We();E($,I)};q(Z,$=>{d(o)&&$(J)})}u(r),O($=>{C.disabled=d(o),F.disabled=$,W(G,d(o)?"Processing (yt-dlp + ffmpeg + madmom)...":"Download & Process Audio")},[()=>d(o)||!d(l).trim()]),se(C,()=>d(l),$=>x(l,$)),E(a,r)};q(b,a=>{d(s)==="file"?a(P):a(m,!1)})}O(()=>{K(T,1,`flex-1 py-2 px-4 border rounded-md text-sm font-medium ${d(s)==="file"?"border-indigo-500 text-indigo-600 bg-indigo-50":"border-gray-300 text-gray-700 bg-white hover:bg-gray-50"}`),K(v,1,`flex-1 py-2 px-4 border rounded-md text-sm font-medium ${d(s)==="youtube"?"border-indigo-500 text-indigo-600 bg-indigo-50":"border-gray-300 text-gray-700 bg-white hover:bg-gray-50"}`)}),E(g,D)};q(p,g=>{e.hasAudio&&e.audioFile?g(U):g(j,!1)})}u(M),E(t,M),ie()}te(["click","change"]);export{it as A,rt as I,at as a};
