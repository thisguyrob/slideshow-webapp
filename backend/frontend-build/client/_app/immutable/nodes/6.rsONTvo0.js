import"../chunks/CWj6FrbW.js";import{d as _e,s as K,e as de,c as Ae,o as Ee}from"../chunks/gcnQ8rQN.js";import{p as we,d as U,B as xe,e as k,h as i,r as s,i as f,g as e,t as G,a as b,f as ve,b as ke,s as l,u as je,a0 as Te,a8 as Ce,a1 as Me,$ as Re,c as Ie}from"../chunks/D902iWF1.js";import{i as D}from"../chunks/ZYqiJWqh.js";import{e as ze,s as Oe,g as X,a as be,r as Fe,d as Be,b as De}from"../chunks/BESee3hx.js";import{p as Pe,b as He,s as Le,a as We}from"../chunks/BuPMYCAJ.js";import{s as ye,p as Ne}from"../chunks/Bf8xj146.js";import{g as Se}from"../chunks/BEMLZ1wU.js";var Ve=(L,r,I)=>r(e(I).id),Je=k('<img class="w-full h-full object-cover cursor-move" draggable="true"/> <div class="absolute bottom-2 right-2 z-10 bg-black bg-opacity-60 text-white p-1 rounded opacity-0 group-hover:opacity-100 transition-opacity"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 9l4-4 4 4m0 6l-4 4-4-4"></path></svg></div> <button class="absolute top-2 right-2 z-10 bg-red-500 hover:bg-red-600 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs transition-colors" title="Remove image">×</button>',1),Qe=k('<svg class="animate-spin h-8 w-8 mb-2" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="m4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg> <span class="text-sm"> </span> <div class="w-16 bg-gray-200 rounded-full h-1 mt-1"><div class="bg-blue-500 h-1 rounded-full transition-all duration-300"></div></div>',1),qe=k('<span class="text-xs text-orange-600"> </span>'),Ye=k('<svg class="h-8 w-8 mb-2 text-orange-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg> <span class="text-sm">In Queue...</span> <!>',1),Ge=k('<div class="flex flex-col items-center justify-center h-full text-gray-500"><!></div>'),Xe=(L,r,I)=>r(e(I).id,L),Ke=k('<label class="flex flex-col items-center justify-center h-full cursor-pointer text-gray-400 hover:text-gray-600 transition-colors"><input type="file" accept="image/*" multiple class="hidden"/> <svg class="w-12 h-12 mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path></svg> <span class="text-sm text-center px-2">Add Image(s)<br/> <span class="text-xs">or drag & drop multiple</span></span></label>'),Ze=k('<div><div class="absolute top-2 left-2 z-10 bg-black bg-opacity-60 text-white text-xs px-2 py-1 rounded"> </div> <!></div>'),$e=k('<div class="scavenger-hunt-grid"><div class="grid grid-cols-4 gap-4 max-w-4xl mx-auto svelte-1bhqdz2"></div> <div class="mt-6 text-center"><div class="text-sm text-gray-600 mb-2"> </div> <div class="w-full max-w-md mx-auto bg-gray-200 rounded-full h-2"><div class="bg-green-500 h-2 rounded-full transition-all duration-300"></div></div></div></div>');function et(L,r){we(r,!0);let I=Pe(r,"slots",19,()=>[]);async function W(){try{await fetch(`${X()}/api/uploads/${r.projectId}/files/slideshow.mp4`,{method:"DELETE"})}catch{console.log("Slideshow file not found or already deleted")}}let u=U(xe(I().length===12?I():Array.from({length:12},(t,a)=>{var o,v;return{id:a+1,image:(o=I()[a])==null?void 0:o.image,filename:(v=I()[a])==null?void 0:v.filename}}))),d=U(null),T=U(null),p=U(!1),y=U(xe([])),A=U(!1),M=0;function ue(){return new Set(e(u).filter(t=>t.filename).map(t=>t.filename))}function Z(t,a){if(ue().has(t.name))return alert(`Image "${t.name}" is already uploaded in another slot. Please choose a different image.`),!1;if(e(u)[a-1].image)return alert(`Slot ${a} is already occupied. Please choose an empty slot.`),!1;if(e(y).find(x=>x.slotId===a&&(x.status==="pending"||x.status==="uploading")))return alert(`Slot ${a} already has an upload in progress.`),!1;const g={id:`upload_${M++}`,file:t,slotId:a,status:"pending",progress:0,retryCount:0};return e(y).push(g),O(),!0}async function O(){if(e(A))return;const t=e(y).filter(o=>o.status==="pending");if(t.length===0)return;l(A,!0);for(const o of t){if(o.status!=="pending")continue;o.status="uploading",l(y,e(y),!0),await oe(o)?(o.status="completed",o.progress=100,setTimeout(()=>{l(y,e(y).filter(g=>g.id!==o.id),!0)},2e3)):o.retryCount<2?(o.retryCount++,o.status="pending",o.progress=0,console.log(`Retrying upload for slot ${o.slotId}, attempt ${o.retryCount+1}`)):(o.status="error",o.error="Upload failed after 3 attempts"),l(y,e(y),!0),await new Promise(g=>setTimeout(g,500))}l(A,!1),e(y).filter(o=>o.status==="pending").length>0&&setTimeout(()=>O(),1e3)}async function oe(t){try{const a=new FormData;a.append("images",t.file),a.append("slot",t.slotId.toString());const o=new XMLHttpRequest;o.upload.addEventListener("progress",g=>{g.lengthComputable&&(t.progress=g.loaded/g.total*100,l(y,e(y),!0))});const v=new Promise(g=>{o.addEventListener("load",async()=>{var x,j;if(o.status===200)try{const R=JSON.parse(o.responseText),n=t.slotId-1;e(u)[n]={id:t.slotId,image:((x=R.file)==null?void 0:x.url)||`/api/files/${r.projectId}/${R.filename}`,filename:R.filename},await W(),(j=r.onSlotsUpdate)==null||j.call(r,e(u)),g(!0)}catch(R){console.error("Failed to parse response:",R),t.error="Invalid server response",g(!1)}else{try{const R=JSON.parse(o.responseText);t.error=R.error||"Upload failed"}catch{t.error=`Upload failed with status ${o.status}`}g(!1)}}),o.addEventListener("error",()=>{t.error="Network error during upload",g(!1)})});return o.open("POST",`${X()}/api/uploads/${r.projectId}/scavenger-hunt-slot`),o.send(a),await v}catch(a){return console.error("Upload error:",a),t.error=a instanceof Error?a.message:"Unknown error",!1}}async function ae(t,a){return Z(a,t)}async function re(t){var o;const a=e(u)[t-1];if(a.filename)try{if((await fetch(`${X()}/api/uploads/${r.projectId}/files/${a.filename}`,{method:"DELETE"})).ok){const g=t-1;e(u)[g]={id:t},await W(),(o=r.onSlotsUpdate)==null||o.call(r,e(u))}else alert("Failed to remove image. Please try again.")}catch(v){console.error("Remove error:",v),alert("Failed to remove image. Please try again.")}}function C(t,a){const o=a.target,v=o.files;v&&v.length>0&&(v.length===1?ae(t,v[0]):E(t,v)),o.value=""}function E(t,a){const o=ue(),v=[];let g=t-1;for(let x=0;x<a.length&&v.length<12;x++){const j=a[x];if(o.has(j.name)){console.log(`Skipping duplicate file: ${j.name}`);continue}for(;g<12&&e(u)[g].image;)g++;if(g<12)v.push({file:j,slotId:g+1}),o.add(j.name),g++;else break}if(v.length===0){alert("No available slots or all selected images are already uploaded.");return}if(v.length<a.length){const x=a.length-v.length;alert(`Queuing ${v.length} files. ${x} files were skipped (no available slots or duplicates).`)}for(const{file:x,slotId:j}of v){const R={id:`upload_${M++}`,file:x,slotId:j,status:"pending",progress:0,retryCount:0};e(y).push(R)}O()}function N(t,a){var v;if(a.preventDefault(),l(d,null),e(p)&&e(T)!==null){Q(e(T),t),l(p,!1),l(T,null);return}const o=(v=a.dataTransfer)==null?void 0:v.files;if(o&&o.length>0){const g=Array.from(o).filter(x=>x.type.startsWith("image/")||x.name.toLowerCase().endsWith(".heic"));if(g.length===0){alert("Please upload image files only (JPEG, PNG, HEIC, etc.)");return}if(g.length===1)ae(t,g[0]);else{const x=new DataTransfer;g.forEach(j=>x.items.add(j)),E(t,x.files)}}}function J(t,a){a.preventDefault(),l(d,t,!0)}function V(t){t.preventDefault(),l(d,null)}function c(t,a){l(T,t,!0),l(p,!0);const o=a.target;o.style.opacity="0.5",a.dataTransfer.effectAllowed="move"}function P(t){const a=t.target;a.style.opacity="1",l(p,!1),l(T,null),l(d,null)}async function Q(t,a){var j;if(t===a)return;const o=t-1,v=a-1,g={...e(u)[o]},x={...e(u)[v]};e(u)[o]={id:t,image:x.image,filename:x.filename},e(u)[v]={id:a,image:g.image,filename:g.filename},l(u,e(u),!0),await h(),await W(),(j=r.onSlotsUpdate)==null||j.call(r,e(u))}async function h(){try{const t=await fetch(`${X()}/api/uploads/${r.projectId}/save-slots`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({slots:e(u)})});t.ok||console.error("Failed to save slot order:",t.status,t.statusText)}catch(t){console.error("Error saving slots:",t)}}var _=$e(),q=i(_);ze(q,21,()=>e(u),t=>t.id,(t,a)=>{var o=Ze(),v=i(o),g=i(v,!0);s(v);var x=f(v,2);{var j=n=>{var m=Je(),F=ve(m),$=f(F,4);$.__click=[Ve,re,a],G(S=>{be(F,"src",S),be(F,"alt",`Slot ${e(a).id??""}`)},[()=>e(a).image.startsWith("http")?e(a).image:`${X()}${e(a).image}`]),de("dragstart",F,S=>c(e(a).id,S)),de("dragend",F,P),b(n,m)},R=(n,m)=>{{var F=S=>{var w=Ge();const z=je(()=>e(y).find(B=>B.slotId===e(a).id&&(B.status==="uploading"||B.status==="pending")));var ne=i(w);{var me=B=>{var ee=Qe(),pe=f(ve(ee),2),le=i(pe);s(pe);var H=f(pe,2),te=i(H);s(H),G(he=>{K(le,`Uploading... ${he??""}%`),ye(te,`width: ${e(z).progress??""}%`)},[()=>Math.round(e(z).progress)]),b(B,ee)},Y=B=>{var ee=Ye(),pe=f(ve(ee),4);{var le=H=>{var te=qe(),he=i(te);s(te),G(()=>K(he,`Retry ${e(z).retryCount+1}`)),b(H,te)};D(pe,H=>{var te;((te=e(z))==null?void 0:te.retryCount)>0&&H(le)})}b(B,ee)};D(ne,B=>{var ee;((ee=e(z))==null?void 0:ee.status)==="uploading"?B(me):B(Y,!1)})}s(w),b(S,w)},$=S=>{var w=Ke(),z=i(w);z.__change=[Xe,C,a],Te(4),s(w),b(S,w)};D(n,S=>{e(y).find(w=>w.slotId===e(a).id&&(w.status==="uploading"||w.status==="pending"))?S(F):S($,!1)},m)}};D(x,n=>{e(a).image?n(j):n(R,!1)})}s(o),G(()=>{Oe(o,1,`slot group aspect-square border-2 border-dashed border-gray-300 rounded-lg relative overflow-hidden transition-all duration-200 hover:border-gray-400 ${e(d)===e(a).id?"border-blue-500 bg-blue-50":""} ${e(p)&&e(T)!==e(a).id?"hover:border-green-500":""}`,"svelte-1bhqdz2"),K(g,e(a).id)}),de("drop",o,n=>N(e(a).id,n)),de("dragover",o,n=>J(e(a).id,n)),de("dragleave",o,V),b(t,o)}),s(q);var ce=f(q,2),se=i(ce),ie=i(se);s(se);var ge=f(se,2),fe=i(ge);s(ge),s(ce),s(_),G((t,a)=>{K(ie,`${t??""} of 12 slots filled`),ye(fe,`width: ${a??""}%`)},[()=>e(u).filter(t=>t.image).length,()=>e(u).filter(t=>t.image).length/12*100]),b(L,_),ke()}_e(["click","change"]);function tt(L,r){r("replace")}var at=Me('<svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24"><path d="M6 4h4v16H6V4zm8 0h4v16h-4V4z"></path></svg>'),rt=Me('<svg class="w-4 h-4 ml-0.5" fill="currentColor" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"></path></svg>'),ot=k('<div class="bg-white rounded-lg border border-gray-200 p-6"><div class="flex items-center justify-between mb-4"><div class="flex items-center space-x-4"><svg class="h-10 w-10 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"></path></svg> <div><p class="text-sm font-medium text-gray-900">Scavenger Hunt Audio Ready</p> <p class="text-sm text-gray-500"><!></p></div></div> <button class="text-sm font-medium text-blue-600 hover:text-blue-500">Replace</button></div> <audio preload="metadata"><source type="audio/mpeg"/></audio> <div class="space-y-3"><div class="flex items-center space-x-4"><button class="flex-shrink-0 w-10 h-10 rounded-full bg-green-600 hover:bg-green-700 text-white flex items-center justify-center transition-colors"><!></button> <div class="text-sm text-gray-500 tabular-nums"> </div></div> <div class="space-y-2"><div class="relative"><div class="h-2 rounded-full"></div> <div class="absolute top-0 left-0 h-2 bg-green-600 rounded-full transition-all duration-100"></div> <input type="range" min="0" max="100" class="absolute top-0 left-0 w-full h-2 opacity-0 cursor-pointer"/></div> <div class="flex justify-between text-xs text-gray-400"><span>Fade In</span> <span>Slideshow Content</span> <span>Fade Out</span></div></div></div></div>');function st(L,r){we(r,!0);let I=Pe(r,"audioDuration",3,73);const W=Ae();let u,d=U(!1),T=U(0),p=U(xe(I()));function y(){u&&(e(d)?u.pause():u.play())}function A(){u&&l(T,u.currentTime,!0)}function M(){u&&l(p,u.duration,!0)}function ue(){l(d,!1),l(T,0)}function Z(){l(d,!0)}function O(){l(d,!1)}function oe(n){const m=n.target,F=parseFloat(m.value)/100*e(p);u&&(u.currentTime=F)}function ae(n){const m=Math.floor(n/60),F=Math.floor(n%60);return`${m}:${F.toString().padStart(2,"0")}`}function re(n,m){const F=1/m*100,$=(m-1)/m*100;let S="linear-gradient(to right, ";return S+="rgba(34, 197, 94, 0.3) 0%, ",S+=`rgba(34, 197, 94, 0.3) ${F}%, `,S+=`rgba(34, 197, 94, 0.1) ${F}%, `,S+=`rgba(34, 197, 94, 0.1) ${$}%, `,S+=`rgba(34, 197, 94, 0.3) ${$}%, `,S+="rgba(34, 197, 94, 0.3) 100%)",S}var C=ot(),E=i(C),N=i(E),J=f(i(N),2),V=f(i(J),2),c=i(V);{var P=n=>{var m=Ce();G(()=>K(m,`Trimmed from ${r.audioOffset??""} • ${e(p)??""}s duration`)),b(n,m)},Q=n=>{var m=Ce();G(()=>K(m,`${e(p)??""}s duration • Trimmed for slideshow`)),b(n,m)};D(c,n=>{r.audioOffset&&r.audioOffset!=="0:00"?n(P):n(Q,!1)})}s(V),s(J),s(N);var h=f(N,2);h.__click=[tt,W],s(E);var _=f(E,2),q=i(_);s(_),He(_,n=>u=n,()=>u);var ce=f(_,2),se=i(ce),ie=i(se);ie.__click=y;var ge=i(ie);{var fe=n=>{var m=at();b(n,m)},t=n=>{var m=rt();b(n,m)};D(ge,n=>{e(d)?n(fe):n(t,!1)})}s(ie);var a=f(ie,2),o=i(a);s(a),s(se);var v=f(se,2),g=i(v),x=i(g),j=f(x,2),R=f(j,2);Fe(R),R.__input=oe,s(g),Te(2),s(v),s(ce),s(C),G((n,m,F,$)=>{be(q,"src",`${n??""}/api/files/${r.projectId??""}/${r.audioFile??""}`),K(o,`${m??""} / ${F??""}`),ye(x,`background: ${$??""}`),ye(j,`width: ${e(p)>0?e(T)/e(p)*100:0}%`),Be(R,e(p)>0?e(T)/e(p)*100:0)},[X,()=>ae(e(T)),()=>ae(e(p)),()=>re(e(T),e(p))]),de("timeupdate",_,A),de("loadedmetadata",_,M),de("ended",_,ue),de("play",_,Z),de("pause",_,O),b(L,C),ke()}_e(["click","input"]);async function it(L,r,I,W,u,d,T){if(!e(r).trim()){alert("Please enter a YouTube URL");return}l(I,!0);try{if((await fetch(`${X()}/api/uploads/${W.projectId}/youtube`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:e(r)})})).ok){const y=await fetch(`${X()}/api/uploads/${W.projectId}/youtube-download`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:e(r),startTime:e(u)||"0:00"})});if(y.ok)d("uploaded"),l(r,""),l(u,"0:00"),l(T,!1);else{const A=await y.json();alert(`Download failed: ${A.error||"Unknown error"}`)}}else alert("Invalid YouTube URL. Please try again.")}catch(p){console.error("YouTube error:",p),alert("Failed to process YouTube URL. Please try again.")}finally{l(I,!1)}}var nt=(L,r)=>l(r,!0),lt=k('<div class="bg-white rounded-lg border border-gray-200 p-6"><div class="flex items-center justify-between"><div class="flex items-center space-x-4"><svg class="h-10 w-10 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"></path></svg> <div><p class="text-sm font-medium text-gray-900">Audio uploaded</p> <p class="text-sm text-gray-500"> </p></div></div> <button class="text-sm font-medium text-blue-600 hover:text-blue-500">Replace</button></div> <audio controls class="w-full mt-4"><source/></audio></div>'),dt=(L,r)=>l(r,!1),ut=k('<div class="flex items-center justify-between mb-4"><h3 class="text-sm font-medium text-gray-900">Replace Audio Track</h3> <button class="text-sm text-gray-500 hover:text-gray-700">Cancel</button></div>'),ct=k('<div class="text-sm text-gray-600 bg-gray-50 p-3 rounded-md"><p class="font-medium mb-1">Processing steps:</p> <ul class="list-disc list-inside space-y-1 text-xs"><li>Downloading audio with yt-dlp</li> <li>Converting audio to MP3 with ffmpeg</li> <li>Trimming to 73 seconds for Scavenger Hunt</li></ul> <p class="text-xs text-gray-500 mt-2">Check Docker terminal for detailed logs</p></div>'),vt=k('<div class="bg-white rounded-lg border border-gray-200 p-6"><!> <div class="space-y-4"><div><label for="youtube-url" class="block text-sm font-medium text-gray-700 mb-2">YouTube URL</label> <input id="youtube-url" type="text" placeholder="https://www.youtube.com/watch?v=..." class="block w-full rounded-md border-0 py-1.5 px-3 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-green-600 sm:text-sm sm:leading-6"/></div> <div><label for="start-time" class="block text-sm font-medium text-gray-700 mb-2">Start Time (optional)</label> <input id="start-time" type="text" placeholder="0:00 (mm:ss or hh:mm:ss)" class="block w-full rounded-md border-0 py-1.5 px-3 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-green-600 sm:text-sm sm:leading-6"/> <p class="text-xs text-gray-500 mt-1">Specify where to start extracting audio (default: 0:00)</p></div> <button class="w-full inline-flex justify-center items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-green-600 hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed"> </button> <!></div></div>');function Ue(L,r){we(r,!0);let I=Pe(r,"audioTrimmed",3,!1);const W=Ae();Re(()=>{console.log("ScavengerHuntAudioUpload props:",{hasAudio:r.hasAudio,audioFile:r.audioFile,audioTrimmed:I(),audioDuration:r.audioDuration,audioOffset:r.audioOffset})});let u=U(!1),d=U(""),T=U("0:00"),p=U(!1);var y=Ie(),A=ve(y);{var M=Z=>{var O=Ie(),oe=ve(O);{var ae=C=>{st(C,{get projectId(){return r.projectId},get audioFile(){return r.audioFile},get audioDuration(){return r.audioDuration},get audioOffset(){return r.audioOffset},$$events:{replace:()=>l(p,!0)}})},re=C=>{var E=lt(),N=i(E),J=i(N),V=f(i(J),2),c=f(i(V),2),P=i(c,!0);s(c),s(V),s(J);var Q=f(J,2);Q.__click=[nt,p],s(N);var h=f(N,2),_=i(h);s(h),s(E),G(q=>{K(P,r.audioFile),be(_,"src",`${q??""}/api/files/${r.projectId??""}/${r.audioFile??""}`)},[X]),b(C,E)};D(oe,C=>{I()?C(ae):C(re,!1)})}b(Z,O)},ue=Z=>{var O=vt(),oe=i(O);{var ae=h=>{var _=ut(),q=f(i(_),2);q.__click=[dt,p],s(_),b(h,_)};D(oe,h=>{e(p)&&h(ae)})}var re=f(oe,2),C=i(re),E=f(i(C),2);Fe(E),s(C);var N=f(C,2),J=f(i(N),2);Fe(J),Te(2),s(N);var V=f(N,2);V.__click=[it,d,u,r,T,W,p];var c=i(V,!0);s(V);var P=f(V,2);{var Q=h=>{var _=ct();b(h,_)};D(P,h=>{e(u)&&h(Q)})}s(re),s(O),G(h=>{E.disabled=e(u),J.disabled=e(u),V.disabled=h,K(c,e(u)?"Processing (yt-dlp + ffmpeg + madmom)...":"Download & Process Audio")},[()=>e(u)||!e(d).trim()]),De(E,()=>e(d),h=>l(d,h)),De(J,()=>e(T),h=>l(T,h)),b(Z,O)};D(A,Z=>{r.hasAudio&&r.audioFile&&!e(p)?Z(M):Z(ue,!1)})}b(L,y),ke()}_e(["click"]);async function gt(L,r,I){l(r,!0);try{if(!(await fetch(`${X()}/api/process/${I}/process`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({mode:"normal"})})).ok)throw new Error("Failed to start rendering")}catch(W){console.error("Failed to render slideshow:",W),alert("Failed to start rendering. Please try again."),l(r,!1)}}function ft(L,r){window.open(`${X()}/api/process/${r}/download`,"_blank")}var mt=k('<div class="min-h-screen bg-gray-50 flex justify-center items-center"><div class="animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600"></div></div>'),pt=k('<button disabled class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-green-600 cursor-not-allowed opacity-75"><svg class="animate-spin h-5 w-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4" class="opacity-25"></circle><path fill="currentColor" d="m4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z" class="opacity-75"></path></svg> Rendering...</button>'),ht=k('<button class="inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50"><svg class="h-5 w-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg> Download</button>'),xt=k('<button class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-green-600 hover:bg-green-700"><svg class="h-5 w-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg> </button>'),bt=k('<button disabled class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-gray-400 cursor-not-allowed opacity-75" title="All 12 image slots must be filled to render slideshow"><svg class="h-5 w-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg> </button>'),yt=k('<div class="flex items-center"><!></div>'),_t=k('<div><h2 class="text-lg font-medium text-gray-900 mb-4">Audio</h2> <!></div> <div class="text-sm text-gray-500">Please process your audio first. The image slots will appear once the audio is ready.</div>',1),wt=k('<div><h2 class="text-lg font-medium text-gray-900 mb-4">Images (12 Slots)</h2> <p class="text-sm text-gray-600 mb-6">Upload images to specific slots. Each slot can contain one unique image.</p> <!></div> <div><h2 class="text-lg font-medium text-gray-900 mb-4">Audio</h2> <!></div>',1),kt=k('<div class="space-y-8"><!></div>'),Tt=k('<div class="min-h-screen bg-gray-50"><header class="bg-white shadow-sm border-b"><div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"><div class="flex justify-between items-center h-16"><div class="flex items-center"><a href="/" class="text-gray-500 hover:text-gray-700 mr-4" aria-label="Back to home"><svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg></a> <div class="flex items-center gap-3"><h1 class="text-2xl font-bold text-gray-900"> </h1> <span> </span></div></div> <!></div></div></header> <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8"><!></main></div>');function At(L,r){we(r,!0);const[I,W]=We(),u=()=>Le(Ne,"$page",I);let d=U(null),T=U(!0),p=U(!1),y=U(!1),A=U(xe([]));const M=u().params.id;function ue(c){if(!c.video||!c.lastProcessed)return!1;if(c.updatedAt&&c.lastProcessed){const P=new Date(c.updatedAt).getTime();return new Date(c.lastProcessed).getTime()>=P}return!0}async function Z(){try{const c=await fetch(`${X()}/api/uploads/${M}/scavenger-hunt-slots`);if(c.ok){const P=await c.json();l(A,P.slots,!0)}}catch(c){console.error("Failed to load slots:",c),l(A,Array.from({length:12},(P,Q)=>({id:Q+1})),!0)}}async function O(){try{const c=await fetch(`${X()}/api/projects/${M}`);if(c.ok){if(l(d,await c.json(),!0),l(y,!!e(d).video&&ue(e(d)),!0),e(d).type!=="Scavenger-Hunt"){Se(`/project/${M}`);return}await Z()}else console.error("Project not found:",M),alert("Project not found. Redirecting to home page."),Se("/")}catch(c){console.error("Failed to load project:",c),alert("Failed to load project. Redirecting to home page."),Se("/")}finally{l(T,!1)}}function oe(c){switch(c){case"FWI-main":return"FWI Main";case"FWI-emotional":return"FWI Emotional";case"Scavenger-Hunt":return"Scavenger Hunt";default:return"FWI Main"}}function ae(c){switch(c){case"FWI-main":return"bg-blue-100 text-blue-800";case"FWI-emotional":return"bg-purple-100 text-purple-800";case"Scavenger-Hunt":return"bg-green-100 text-green-800";default:return"bg-blue-100 text-blue-800"}}Ee(()=>{O();const c=window.location.hostname,P=new WebSocket(`ws://${c}:3000`);return P.onmessage=Q=>{const h=JSON.parse(Q.data);if(h.projectId===M){const _=e(d).type;l(d,{...e(d),...h,type:_},!0),h.type==="progress"&&h.progress===100&&(l(p,!1),l(y,!0),O()),h.type==="progress"&&h.progress===-1&&l(p,!1)}},()=>{P.close()}});function re(){l(y,!1),O()}function C(c){l(A,c,!0),O()}var E=Ie(),N=ve(E);{var J=c=>{var P=mt();b(c,P)},V=(c,P)=>{{var Q=h=>{var _=Tt(),q=i(_),ce=i(q),se=i(ce),ie=i(se),ge=f(i(ie),2),fe=i(ge),t=i(fe,!0);s(fe);var a=f(fe,2),o=i(a,!0);s(a),s(ge),s(ie);var v=f(ie,2);{var g=n=>{var m=yt(),F=i(m);{var $=w=>{var z=pt();b(w,z)},S=(w,z)=>{{var ne=Y=>{var B=ht();B.__click=[ft,M],b(Y,B)},me=(Y,B)=>{{var ee=le=>{var H=xt();H.__click=[gt,p,M];var te=f(i(H));s(H),G(()=>K(te,` ${e(d).video?"Re-render Slideshow":"Render Slideshow"}`)),b(le,H)},pe=le=>{var H=bt(),te=f(i(H));s(H),G(he=>K(te,` ${he??""}/12 Images Required`),[()=>e(A).filter(he=>he.image).length]),b(le,H)};D(Y,le=>{e(A).filter(H=>H.image).length===12?le(ee):le(pe,!1)},B)}};D(w,Y=>{ue(e(d))?Y(ne):Y(me,!1)},z)}};D(F,w=>{e(p)?w($):w(S,!1)})}s(m),b(n,m)};D(v,n=>{e(A).some(m=>m.image)&&e(d).audioTrimmed&&n(g)})}s(se),s(ce),s(q);var x=f(q,2),j=i(x);{var R=n=>{var m=kt(),F=i(m);{var $=w=>{var z=_t(),ne=ve(z),me=f(i(ne),2);const Y=je(()=>!!e(d).audio);Ue(me,{get projectId(){return M},get hasAudio(){return e(Y)},get audioFile(){return e(d).audio},get audioTrimmed(){return e(d).audioTrimmed},get audioDuration(){return e(d).audioDuration},get audioOffset(){return e(d).audioOffset},$$events:{uploaded:re}}),s(ne),Te(2),b(w,z)},S=w=>{var z=wt(),ne=ve(z),me=f(i(ne),4);et(me,{get projectId(){return M},get slots(){return e(A)},onSlotsUpdate:C}),s(ne);var Y=f(ne,2),B=f(i(Y),2);const ee=je(()=>!!e(d).audio);Ue(B,{get projectId(){return M},get hasAudio(){return e(ee)},get audioFile(){return e(d).audio},get audioTrimmed(){return e(d).audioTrimmed},get audioDuration(){return e(d).audioDuration},get audioOffset(){return e(d).audioOffset},$$events:{uploaded:re}}),s(Y),b(w,z)};D(F,w=>{e(d).audioTrimmed?w(S,!1):w($)})}s(m),b(n,m)};D(j,n=>{n(R)})}s(x),s(_),G((n,m)=>{K(t,e(d).name),Oe(a,1,`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ${n??""}`),K(o,m)},[()=>ae(e(d).type),()=>oe(e(d).type)]),b(h,_)};D(c,h=>{e(d)&&h(Q)},P)}};D(N,c=>{e(T)?c(J):c(V,!1)})}b(L,E),ke(),W()}_e(["click"]);export{At as component};
