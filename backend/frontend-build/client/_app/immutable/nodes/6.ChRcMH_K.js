import"../chunks/CWj6FrbW.js";import{d as ke,s as te,e as ne,c as Be,o as Re}from"../chunks/BVW34SQx.js";import{p as Se,B as be,d as C,e as T,h as i,i as v,r as o,g as e,t as Z,a as f,f as ve,b as Te,s as l,a0 as he,a1 as je,a8 as Ue,$ as Ee,c as _e,u as Me}from"../chunks/CNfditUa.js";import{i as D}from"../chunks/GC4dxQQb.js";import{e as He,s as ye,g as K,a as we,r as De,d as Ve,b as Oe}from"../chunks/BEFEBz6G.js";import{p as Ae,b as Le,s as We,a as Ne}from"../chunks/0rDqRz2G.js";import{s as Ce,p as Je,S as Ye}from"../chunks/Cty7KhZ4.js";import{g as Ie}from"../chunks/D7x77NIs.js";var qe=je('<svg class="animate-spin h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="m4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg> ',1),Ge=je('<svg class="h-5 w-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path></svg> Upload Multiple Images (Max 12)',1),Ke=T('<div class="mb-6 text-center"><label><input type="file" accept="image/*" multiple class="hidden"/> <!></label> <p class="mt-2 text-sm text-gray-500">Select up to 12 images at once, or click individual slots below</p></div>'),Qe=(A,t,j)=>t(e(j).id),Xe=T('<img class="w-full h-full object-cover cursor-move" draggable="true"/> <div class="absolute bottom-2 right-2 z-10 bg-black bg-opacity-60 text-white p-1 rounded opacity-0 group-hover:opacity-100 transition-opacity"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 9l4-4 4 4m0 6l-4 4-4-4"></path></svg></div> <button class="absolute top-2 right-2 z-10 bg-red-500 hover:bg-red-600 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs transition-colors" title="Remove image">Ã—</button>',1),Ze=T('<div class="flex flex-col items-center justify-center h-full text-gray-500"><svg class="animate-spin h-8 w-8 mb-2" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="m4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg> <span class="text-sm">Uploading...</span></div>'),$e=(A,t,j)=>t(e(j).id,A),et=T('<label class="flex flex-col items-center justify-center h-full cursor-pointer text-gray-400 hover:text-gray-600 transition-colors"><input type="file" accept="image/*" class="hidden"/> <svg class="w-12 h-12 mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path></svg> <span class="text-sm text-center px-2">Add Image<br/> <span class="text-xs">or drag & drop</span></span></label>'),tt=T('<div><div class="absolute top-2 left-2 z-10 bg-black bg-opacity-60 text-white text-xs px-2 py-1 rounded"> </div> <!></div>'),at=T('<div class="scavenger-hunt-grid"><!> <div class="grid grid-cols-4 gap-4 max-w-4xl mx-auto svelte-1bhqdz2"></div> <div class="mt-6 text-center"><div class="text-sm text-gray-600 mb-2"> </div> <div class="w-full max-w-md mx-auto bg-gray-200 rounded-full h-2"><div class="bg-green-500 h-2 rounded-full transition-all duration-300"></div></div></div></div>');function rt(A,t){Se(t,!0);let j=Ae(t,"slots",19,()=>[]);async function R(){try{await fetch(`${K()}/api/uploads/${t.projectId}/files/slideshow.mp4`,{method:"DELETE"})}catch{console.log("Slideshow file not found or already deleted")}}let c=be(j().length===12?j():Array.from({length:12},(a,r)=>{var s,m;return{id:r+1,image:(s=j()[r])==null?void 0:s.image,filename:(m=j()[r])==null?void 0:m.filename}})),n=C(be(new Set)),k=C(null),g=C(null),U=C(!1),M=C(!1),z=C(be({current:0,total:0}));function O(){return new Set(c.filter(a=>a.filename).map(a=>a.filename))}async function Y(a){const r=O(),s=[];let m=0;for(let _=0;_<a.length&&s.length<12;_++){const y=a[_];if(r.has(y.name)){console.log(`Skipping duplicate file: ${y.name}`);continue}for(;m<12&&c[m].image;)m++;m<12&&(s.push({file:y,slotId:m+1}),r.add(y.name),m++)}if(s.length===0){alert("No available slots or all selected images are already uploaded.");return}l(M,!0),l(z,{current:0,total:s.length},!0);let b=0;for(const{file:_,slotId:y}of s)await N(y,_)&&b++,e(z).current++;l(M,!1),b<s.length&&alert(`Uploaded ${b} of ${s.length} images. Some uploads may have failed.`),l(z,{current:0,total:0},!0)}async function N(a,r){var m,b;const s=O();if(!e(M)&&s.has(r.name))return alert(`Image "${r.name}" is already uploaded in another slot. Please choose a different image.`),!1;e(n).add(a),l(n,e(n),!0);try{const _=new FormData;_.append("images",r),_.append("slot",a.toString());const y=await fetch(`${K()}/api/uploads/${t.projectId}/scavenger-hunt-slot`,{method:"POST",body:_});if(y.ok){const w=await y.json(),d=a-1;return c[d]={id:a,image:((m=w.file)==null?void 0:m.url)||`/api/files/${t.projectId}/${w.filename}`,filename:w.filename},await R(),(b=t.onSlotsUpdate)==null||b.call(t,c),!0}else{const w=await y.json();return e(M)||alert(`Upload failed: ${w.error||"Unknown error"}`),!1}}catch(_){return console.error("Upload error:",_),e(M)||alert("Upload failed. Please try again."),!1}finally{e(n).delete(a),l(n,e(n),!0)}}async function q(a){var s;const r=c[a-1];if(r.filename)try{if((await fetch(`${K()}/api/uploads/${t.projectId}/files/${r.filename}`,{method:"DELETE"})).ok){const b=a-1;c[b]={id:a},await R(),(s=t.onSlotsUpdate)==null||s.call(t,c)}else alert("Failed to remove image. Please try again.")}catch(m){console.error("Remove error:",m),alert("Failed to remove image. Please try again.")}}function ae(a,r){var b;const s=r.target,m=(b=s.files)==null?void 0:b[0];m&&N(a,m),s.value=""}function re(a){const r=a.target,s=r.files;s&&s.length>0&&Y(s),r.value=""}function P(a,r){var m;if(r.preventDefault(),l(k,null),e(U)&&e(g)!==null){oe(e(g),a),l(U,!1),l(g,null);return}const s=(m=r.dataTransfer)==null?void 0:m.files;if(s&&s.length>0){const b=s[0];b.type.startsWith("image/")?N(a,b):alert("Please upload an image file (JPEG, PNG, HEIC, etc.)")}}function E(a,r){r.preventDefault(),l(k,a,!0)}function B(a){a.preventDefault(),l(k,null)}function J(a,r){l(g,a,!0),l(U,!0);const s=r.target;s.style.opacity="0.5",r.dataTransfer.effectAllowed="move"}function H(a){const r=a.target;r.style.opacity="1",l(U,!1),l(g,null),l(k,null)}async function oe(a,r){var y;if(a===r)return;const s=a-1,m=r-1,b={...c[s]},_={...c[m]};c[s]={id:a,image:_.image,filename:_.filename},c[m]={id:r,image:b.image,filename:b.filename},await u(),await R(),(y=t.onSlotsUpdate)==null||y.call(t,c)}async function u(){try{(await fetch(`${K()}/api/uploads/${t.projectId}/save-slots`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({slots:c})})).ok||console.error("Failed to save slot order")}catch(a){console.error("Error saving slots:",a)}}var S=at(),x=i(S);{var p=a=>{var r=Ke(),s=i(r),m=i(s);m.__change=re;var b=v(m,2);{var _=w=>{var d=qe(),h=v(ve(d));Z(()=>te(h,` Uploading ${e(z).current??""} of ${e(z).total??""}...`)),f(w,d)},y=w=>{var d=Ge();he(),f(w,d)};D(b,w=>{e(M)?w(_):w(y,!1)})}o(s),he(2),o(r),Z(()=>{ye(s,1,`inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-green-600 hover:bg-green-700 cursor-pointer transition-colors ${e(M)?"opacity-75 cursor-not-allowed":""}`),m.disabled=e(M)}),f(a,r)};D(x,a=>{c.filter(r=>!r.image).length>=2&&a(p)})}var V=v(x,2);He(V,21,()=>c,a=>a.id,(a,r)=>{var s=tt(),m=i(s),b=i(m,!0);o(m);var _=v(m,2);{var y=d=>{var h=Xe(),I=ve(h),$=v(I,4);$.__click=[Qe,q,r],Z(F=>{we(I,"src",F),we(I,"alt",`Slot ${e(r).id??""}`)},[()=>e(r).image.startsWith("http")?e(r).image:`${K()}${e(r).image}`]),ne("dragstart",I,F=>J(e(r).id,F)),ne("dragend",I,H),f(d,h)},w=(d,h)=>{{var I=F=>{var me=Ze();f(F,me)},$=F=>{var me=et(),Fe=i(me);Fe.__change=[$e,ae,r],he(4),o(me),f(F,me)};D(d,F=>{e(n).has(e(r).id)?F(I):F($,!1)},h)}};D(_,d=>{e(r).image?d(y):d(w,!1)})}o(s),Z(()=>{ye(s,1,`slot group aspect-square border-2 border-dashed border-gray-300 rounded-lg relative overflow-hidden transition-all duration-200 hover:border-gray-400 ${e(k)===e(r).id?"border-blue-500 bg-blue-50":""} ${e(U)&&e(g)!==e(r).id?"hover:border-green-500":""}`,"svelte-1bhqdz2"),te(b,e(r).id)}),ne("drop",s,d=>P(e(r).id,d)),ne("dragover",s,d=>E(e(r).id,d)),ne("dragleave",s,B),f(a,s)}),o(V);var le=v(V,2),ie=i(le),de=i(ie);o(ie);var ue=v(ie,2),fe=i(ue);o(ue),o(le),o(S),Z((a,r)=>{te(de,`${a??""} of 12 slots filled`),Ce(fe,`width: ${r??""}%`)},[()=>c.filter(a=>a.image).length,()=>c.filter(a=>a.image).length/12*100]),f(A,S),Te()}ke(["change","click"]);function ot(A,t){t("replace")}var it=je('<svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24"><path d="M6 4h4v16H6V4zm8 0h4v16h-4V4z"></path></svg>'),st=je('<svg class="w-4 h-4 ml-0.5" fill="currentColor" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"></path></svg>'),nt=T('<div class="bg-white rounded-lg border border-gray-200 p-6"><div class="flex items-center justify-between mb-4"><div class="flex items-center space-x-4"><svg class="h-10 w-10 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"></path></svg> <div><p class="text-sm font-medium text-gray-900">Scavenger Hunt Audio Ready</p> <p class="text-sm text-gray-500"><!></p></div></div> <button class="text-sm font-medium text-blue-600 hover:text-blue-500">Replace</button></div> <audio preload="metadata"><source type="audio/mpeg"/></audio> <div class="space-y-3"><div class="flex items-center space-x-4"><button class="flex-shrink-0 w-10 h-10 rounded-full bg-green-600 hover:bg-green-700 text-white flex items-center justify-center transition-colors"><!></button> <div class="text-sm text-gray-500 tabular-nums"> </div></div> <div class="space-y-2"><div class="relative"><div class="h-2 rounded-full"></div> <div class="absolute top-0 left-0 h-2 bg-green-600 rounded-full transition-all duration-100"></div> <input type="range" min="0" max="100" class="absolute top-0 left-0 w-full h-2 opacity-0 cursor-pointer"/></div> <div class="flex justify-between text-xs text-gray-400"><span>Fade In</span> <span>Slideshow Content</span> <span>Fade Out</span></div></div></div></div>');function lt(A,t){Se(t,!0);let j=Ae(t,"audioDuration",3,73);const R=Be();let c,n=C(!1),k=C(0),g=C(be(j()));function U(){c&&(e(n)?c.pause():c.play())}function M(){c&&l(k,c.currentTime,!0)}function z(){c&&l(g,c.duration,!0)}function O(){l(n,!1),l(k,0)}function Y(){l(n,!0)}function N(){l(n,!1)}function q(d){const h=d.target,I=parseFloat(h.value)/100*e(g);c&&(c.currentTime=I)}function ae(d){const h=Math.floor(d/60),I=Math.floor(d%60);return`${h}:${I.toString().padStart(2,"0")}`}function re(d,h){const I=1/h*100,$=(h-1)/h*100;let F="linear-gradient(to right, ";return F+="rgba(34, 197, 94, 0.3) 0%, ",F+=`rgba(34, 197, 94, 0.3) ${I}%, `,F+=`rgba(34, 197, 94, 0.1) ${I}%, `,F+=`rgba(34, 197, 94, 0.1) ${$}%, `,F+=`rgba(34, 197, 94, 0.3) ${$}%, `,F+="rgba(34, 197, 94, 0.3) 100%)",F}var P=nt(),E=i(P),B=i(E),J=v(i(B),2),H=v(i(J),2),oe=i(H);{var u=d=>{var h=Ue();Z(()=>te(h,`Trimmed from ${t.audioOffset??""} â€¢ ${e(g)??""}s duration`)),f(d,h)},S=d=>{var h=Ue();Z(()=>te(h,`${e(g)??""}s duration â€¢ Trimmed for slideshow`)),f(d,h)};D(oe,d=>{t.audioOffset&&t.audioOffset!=="0:00"?d(u):d(S,!1)})}o(H),o(J),o(B);var x=v(B,2);x.__click=[ot,R],o(E);var p=v(E,2),V=i(p);o(p),Le(p,d=>c=d,()=>c);var le=v(p,2),ie=i(le),de=i(ie);de.__click=U;var ue=i(de);{var fe=d=>{var h=it();f(d,h)},a=d=>{var h=st();f(d,h)};D(ue,d=>{e(n)?d(fe):d(a,!1)})}o(de);var r=v(de,2),s=i(r);o(r),o(ie);var m=v(ie,2),b=i(m),_=i(b),y=v(_,2),w=v(y,2);De(w),w.__input=q,o(b),he(2),o(m),o(le),o(P),Z((d,h,I,$)=>{we(V,"src",`${d??""}/api/files/${t.projectId??""}/${t.audioFile??""}`),te(s,`${h??""} / ${I??""}`),Ce(_,`background: ${$??""}`),Ce(y,`width: ${e(g)>0?e(k)/e(g)*100:0}%`),Ve(w,e(g)>0?e(k)/e(g)*100:0)},[K,()=>ae(e(k)),()=>ae(e(g)),()=>re(e(k),e(g))]),ne("timeupdate",p,M),ne("loadedmetadata",p,z),ne("ended",p,O),ne("play",p,Y),ne("pause",p,N),f(A,P),Te()}ke(["click","input"]);async function dt(A,t,j,R,c,n,k){if(!e(t).trim()){alert("Please enter a YouTube URL");return}l(j,!0);try{if((await fetch(`${K()}/api/uploads/${R.projectId}/youtube`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:e(t)})})).ok){const U=await fetch(`${K()}/api/uploads/${R.projectId}/youtube-download`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:e(t),startTime:e(c)||"0:00"})});if(U.ok)n("uploaded"),l(t,""),l(c,"0:00"),l(k,!1);else{const M=await U.json();alert(`Download failed: ${M.error||"Unknown error"}`)}}else alert("Invalid YouTube URL. Please try again.")}catch(g){console.error("YouTube error:",g),alert("Failed to process YouTube URL. Please try again.")}finally{l(j,!1)}}var ct=(A,t)=>l(t,!0),ut=T('<div class="bg-white rounded-lg border border-gray-200 p-6"><div class="flex items-center justify-between"><div class="flex items-center space-x-4"><svg class="h-10 w-10 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3"></path></svg> <div><p class="text-sm font-medium text-gray-900">Audio uploaded</p> <p class="text-sm text-gray-500"> </p></div></div> <button class="text-sm font-medium text-blue-600 hover:text-blue-500">Replace</button></div> <audio controls class="w-full mt-4"><source/></audio></div>'),vt=(A,t)=>l(t,!1),mt=T('<div class="flex items-center justify-between mb-4"><h3 class="text-sm font-medium text-gray-900">Replace Audio Track</h3> <button class="text-sm text-gray-500 hover:text-gray-700">Cancel</button></div>'),gt=T('<div class="text-sm text-gray-600 bg-gray-50 p-3 rounded-md"><p class="font-medium mb-1">Processing steps:</p> <ul class="list-disc list-inside space-y-1 text-xs"><li>Downloading audio with yt-dlp</li> <li>Converting audio to MP3 with ffmpeg</li> <li>Trimming to 73 seconds for Scavenger Hunt</li></ul> <p class="text-xs text-gray-500 mt-2">Check Docker terminal for detailed logs</p></div>'),ft=T('<div class="bg-white rounded-lg border border-gray-200 p-6"><!> <div class="space-y-4"><div><label for="youtube-url" class="block text-sm font-medium text-gray-700 mb-2">YouTube URL</label> <input id="youtube-url" type="text" placeholder="https://www.youtube.com/watch?v=..." class="block w-full rounded-md border-0 py-1.5 px-3 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-green-600 sm:text-sm sm:leading-6"/></div> <div><label for="start-time" class="block text-sm font-medium text-gray-700 mb-2">Start Time (optional)</label> <input id="start-time" type="text" placeholder="0:00 (mm:ss or hh:mm:ss)" class="block w-full rounded-md border-0 py-1.5 px-3 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-green-600 sm:text-sm sm:leading-6"/> <p class="text-xs text-gray-500 mt-1">Specify where to start extracting audio (default: 0:00)</p></div> <button class="w-full inline-flex justify-center items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-green-600 hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed"> </button> <!></div></div>');function ze(A,t){Se(t,!0);let j=Ae(t,"audioTrimmed",3,!1);const R=Be();Ee(()=>{console.log("ScavengerHuntAudioUpload props:",{hasAudio:t.hasAudio,audioFile:t.audioFile,audioTrimmed:j(),audioDuration:t.audioDuration,audioOffset:t.audioOffset})});let c=C(!1),n=C(""),k=C("0:00"),g=C(!1);var U=_e(),M=ve(U);{var z=Y=>{var N=_e(),q=ve(N);{var ae=P=>{lt(P,{get projectId(){return t.projectId},get audioFile(){return t.audioFile},get audioDuration(){return t.audioDuration},get audioOffset(){return t.audioOffset},$$events:{replace:()=>l(g,!0)}})},re=P=>{var E=ut(),B=i(E),J=i(B),H=v(i(J),2),oe=v(i(H),2),u=i(oe,!0);o(oe),o(H),o(J);var S=v(J,2);S.__click=[ct,g],o(B);var x=v(B,2),p=i(x);o(x),o(E),Z(V=>{te(u,t.audioFile),we(p,"src",`${V??""}/api/files/${t.projectId??""}/${t.audioFile??""}`)},[K]),f(P,E)};D(q,P=>{j()?P(ae):P(re,!1)})}f(Y,N)},O=Y=>{var N=ft(),q=i(N);{var ae=x=>{var p=mt(),V=v(i(p),2);V.__click=[vt,g],o(p),f(x,p)};D(q,x=>{e(g)&&x(ae)})}var re=v(q,2),P=i(re),E=v(i(P),2);De(E),o(P);var B=v(P,2),J=v(i(B),2);De(J),he(2),o(B);var H=v(B,2);H.__click=[dt,n,c,t,k,R,g];var oe=i(H,!0);o(H);var u=v(H,2);{var S=x=>{var p=gt();f(x,p)};D(u,x=>{e(c)&&x(S)})}o(re),o(N),Z(x=>{E.disabled=e(c),J.disabled=e(c),H.disabled=x,te(oe,e(c)?"Processing (yt-dlp + ffmpeg + madmom)...":"Download & Process Audio")},[()=>e(c)||!e(n).trim()]),Oe(E,()=>e(n),x=>l(n,x)),Oe(J,()=>e(k),x=>l(k,x)),f(Y,N)};D(M,Y=>{t.hasAudio&&t.audioFile&&!e(g)?Y(z):Y(O,!1)})}f(A,U),Te()}ke(["click"]);async function pt(A,t,j){l(t,!0);try{if(!(await fetch(`${K()}/api/process/${j}/process`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({mode:"normal"})})).ok)throw new Error("Failed to start rendering")}catch(R){console.error("Failed to render slideshow:",R),alert("Failed to start rendering. Please try again."),l(t,!1)}}function ht(A,t){window.open(`${K()}/api/process/${t}/download`,"_blank")}var xt=T('<div class="min-h-screen bg-gray-50 flex justify-center items-center"><div class="animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600"></div></div>'),bt=T('<button disabled class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-green-600 cursor-not-allowed opacity-75"><svg class="animate-spin h-5 w-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4" class="opacity-25"></circle><path fill="currentColor" d="m4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z" class="opacity-75"></path></svg> Rendering...</button>'),yt=T('<button class="inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50"><svg class="h-5 w-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg> Download</button>'),_t=T('<button class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-green-600 hover:bg-green-700"><svg class="h-5 w-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg> </button>'),wt=T('<div class="flex items-center"><!></div>'),kt=(A,t)=>l(t,"images"),St=(A,t)=>l(t,"slideshow"),Tt=T('<div><h2 class="text-lg font-medium text-gray-900 mb-4">Audio</h2> <!></div> <div class="text-sm text-gray-500">Please process your audio first. The image slots will appear once the audio is ready.</div>',1),jt=T('<div><h2 class="text-lg font-medium text-gray-900 mb-4">Images (12 Slots)</h2> <p class="text-sm text-gray-600 mb-6">Upload images to specific slots. Each slot can contain one unique image.</p> <!></div> <div><h2 class="text-lg font-medium text-gray-900 mb-4">Audio</h2> <!></div>',1),Ft=T('<div class="space-y-8"><!></div>'),Pt=T('<div class="text-center py-12"><svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg> <h3 class="mt-2 text-sm font-medium text-gray-900">Add images and audio first</h3> <p class="mt-1 text-sm text-gray-500">Upload audio and images to preview the slideshow.</p></div>'),It=T('<div class="min-h-screen bg-gray-50"><header class="bg-white shadow-sm border-b"><div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"><div class="flex justify-between items-center h-16"><div class="flex items-center"><a href="/" class="text-gray-500 hover:text-gray-700 mr-4" aria-label="Back to home"><svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg></a> <div class="flex items-center gap-3"><h1 class="text-2xl font-bold text-gray-900"> </h1> <span> </span></div></div> <!></div></div></header> <div class="bg-white border-b"><div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"><nav class="-mb-px flex space-x-8" aria-label="Tabs"><button>Images & Audio</button> <button>Preview Slideshow</button></nav></div></div> <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8"><!></main></div>');function Rt(A,t){Se(t,!0);const[j,R]=Ne(),c=()=>We(Je,"$page",j);let n=C(null),k=C(!0),g=C("images"),U=C(!1),M=C(!1),z=C(be([]));const O=c().params.id;function Y(u){if(!u.video||!u.lastProcessed)return!1;if(u.updatedAt&&u.lastProcessed){const S=new Date(u.updatedAt).getTime();return new Date(u.lastProcessed).getTime()>=S}return!0}async function N(){try{const u=await fetch(`${K()}/api/uploads/${O}/scavenger-hunt-slots`);if(u.ok){const S=await u.json();l(z,S.slots,!0)}}catch(u){console.error("Failed to load slots:",u),l(z,Array.from({length:12},(S,x)=>({id:x+1})),!0)}}async function q(){try{const u=await fetch(`${K()}/api/projects/${O}`);if(u.ok){if(l(n,await u.json(),!0),l(M,!!e(n).video&&Y(e(n)),!0),e(n).type!=="Scavenger-Hunt"){Ie(`/project/${O}`);return}await N()}else console.error("Project not found:",O),alert("Project not found. Redirecting to home page."),Ie("/")}catch(u){console.error("Failed to load project:",u),alert("Failed to load project. Redirecting to home page."),Ie("/")}finally{l(k,!1)}}function ae(u){switch(u){case"FWI-main":return"FWI Main";case"FWI-emotional":return"FWI Emotional";case"Scavenger-Hunt":return"Scavenger Hunt";default:return"FWI Main"}}function re(u){switch(u){case"FWI-main":return"bg-blue-100 text-blue-800";case"FWI-emotional":return"bg-purple-100 text-purple-800";case"Scavenger-Hunt":return"bg-green-100 text-green-800";default:return"bg-blue-100 text-blue-800"}}Re(()=>{q();const u=window.location.hostname,S=new WebSocket(`ws://${u}:3000`);return S.onmessage=x=>{const p=JSON.parse(x.data);if(p.projectId===O){const V=e(n).type;l(n,{...e(n),...p,type:V},!0),p.type==="progress"&&p.progress===100&&(l(U,!1),l(M,!0),q()),p.type==="progress"&&p.progress===-1&&l(U,!1)}},()=>{S.close()}});function P(){l(M,!1),q()}function E(u){l(z,u,!0),q()}var B=_e(),J=ve(B);{var H=u=>{var S=xt();f(u,S)},oe=(u,S)=>{{var x=p=>{var V=It(),le=i(V),ie=i(le),de=i(ie),ue=i(de),fe=v(i(ue),2),a=i(fe),r=i(a,!0);o(a);var s=v(a,2),m=i(s,!0);o(s),o(fe),o(ue);var b=v(ue,2);{var _=Q=>{var G=wt(),xe=i(G);{var ge=L=>{var ee=bt();f(L,ee)},pe=(L,ee)=>{{var se=W=>{var ce=yt();ce.__click=[ht,O],f(W,ce)},X=W=>{var ce=_t();ce.__click=[pt,U,O];var Pe=v(i(ce));o(ce),Z(()=>te(Pe,` ${e(n).video?"Re-render Slideshow":"Render Slideshow"}`)),f(W,ce)};D(L,W=>{Y(e(n))?W(se):W(X,!1)},ee)}};D(xe,L=>{e(U)?L(ge):L(pe,!1)})}o(G),f(Q,G)};D(b,Q=>{e(z).some(G=>G.image)&&e(n).audioTrimmed&&Q(_)})}o(de),o(ie),o(le);var y=v(le,2),w=i(y),d=i(w),h=i(d);h.__click=[kt,g];var I=v(h,2);I.__click=[St,g],o(d),o(w),o(y);var $=v(y,2),F=i($);{var me=Q=>{var G=Ft(),xe=i(G);{var ge=L=>{var ee=Tt(),se=ve(ee),X=v(i(se),2);const W=Me(()=>!!e(n).audio);ze(X,{get projectId(){return O},get hasAudio(){return e(W)},get audioFile(){return e(n).audio},get audioTrimmed(){return e(n).audioTrimmed},get audioDuration(){return e(n).audioDuration},get audioOffset(){return e(n).audioOffset},$$events:{uploaded:P}}),o(se),he(2),f(L,ee)},pe=L=>{var ee=jt(),se=ve(ee),X=v(i(se),4);rt(X,{get projectId(){return O},get slots(){return e(z)},onSlotsUpdate:E}),o(se);var W=v(se,2),ce=v(i(W),2);const Pe=Me(()=>!!e(n).audio);ze(ce,{get projectId(){return O},get hasAudio(){return e(Pe)},get audioFile(){return e(n).audio},get audioTrimmed(){return e(n).audioTrimmed},get audioDuration(){return e(n).audioDuration},get audioOffset(){return e(n).audioOffset},$$events:{uploaded:P}}),o(W),f(L,ee)};D(xe,L=>{e(n).audioTrimmed?L(pe,!1):L(ge)})}o(G),f(Q,G)},Fe=(Q,G)=>{{var xe=ge=>{var pe=_e(),L=ve(pe);{var ee=X=>{Ye(X,{get project(){return e(n)}})},se=X=>{var W=Pt();f(X,W)};D(L,X=>{e(z).some(W=>W.image)&&e(n).audioTrimmed?X(ee):X(se,!1)})}f(ge,pe)};D(Q,ge=>{e(g)==="slideshow"&&ge(xe)},G)}};D(F,Q=>{e(g)==="images"?Q(me):Q(Fe,!1)})}o($),o(V),Z((Q,G)=>{te(r,e(n).name),ye(s,1,`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ${Q??""}`),te(m,G),ye(h,1,`py-4 px-1 border-b-2 font-medium text-sm ${e(g)==="images"?"border-green-500 text-green-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`),ye(I,1,`py-4 px-1 border-b-2 font-medium text-sm ${e(g)==="slideshow"?"border-green-500 text-green-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`)},[()=>re(e(n).type),()=>ae(e(n).type)]),f(p,V)};D(u,p=>{e(n)&&p(x)},S)}};D(J,u=>{e(k)?u(H):u(oe,!1)})}f(A,B),Te(),R()}ke(["click"]);export{Rt as component};
